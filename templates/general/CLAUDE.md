# 프로젝트 — Claude Code 컨텍스트

## 프로젝트 개요

Windmillsoft 조직의 GitHub Issues 기반 프로젝트 관리 체계를 따릅니다.
MCP 서버를 통해 Claude Code가 GitHub 이슈를 직접 조회/생성/관리할 수 있습니다.

## MCP 도구

이 프로젝트에는 `millworks` MCP 서버가 등록되어 있습니다.
아래 도구들을 사용하여 GitHub 이슈를 관리하세요.

| 도구 | 설명 |
|------|------|
| `get_issue` | 이슈 상세 조회 (번호, 제목, 본문, 라벨, 댓글) |
| `list_issues` | 이슈 목록 조회 (상태, 라벨, 담당자 필터) |
| `list_labels` | 레포지토리 라벨 목록 |
| `get_hierarchy` | 이슈 계층 구조 (Sub-Issues 트리) |
| `create_issue` | 새 이슈 생성 |
| `create_sub_issue` | Sub-Issue 생성 + 부모 연결 |
| `update_issue` | 이슈 수정 (제목, 본문, 상태, 라벨, 담당자) |
| `assign_issue` | 담당자 배정/교체 |
| `assign_iteration` | 이슈를 프로젝트 이터레이션에 배정 (선행 작업 배치) |
| `delete_issues` | 이슈 삭제 (계층 전체 삭제 지원, 테스트 정리용) |

### Sub-Issue 연결 시 주의사항 (gh CLI)

MCP `create_sub_issue` 도구를 우선 사용하되, `gh api`로 직접 연결해야 하는 경우:

```bash
# 1. 이슈 ID 조회 (번호가 아닌 정수 ID 필요)
CHILD_ID=$(gh api repos/{owner}/{repo}/issues/{number} --jq '.id')

# 2. Sub-Issue 연결 (-F 대문자로 정수형 전달)
gh api repos/{owner}/{repo}/issues/{parent_number}/sub_issues \
  -F sub_issue_id=$CHILD_ID
```

**주의**: `-f`(소문자, 문자열) 사용 시 422 에러, 이슈 번호 직접 사용 시 404 에러 발생

### 이슈 대량 생성 규칙

1. **생성과 ID 캡처를 한 번에**: `gh api`로 생성하면 응답에서 `number`와 `id`를 동시 확보
   ```bash
   gh api repos/{owner}/{repo}/issues \
     -f title="제목" -f body="본문" \
     -f labels[]="type:개발항목" -f labels[]="status:backlog" \
     --jq '{number: .number, id: .id}'
   ```
2. **생성 순서**: 공통 모듈 L1 → 공통 L3(선행) → 업무영역 L1 → L2 → L3/L4 → Sub-Issue 연결 → MD 역참조
3. **번호-ID 매핑 유지**: 생성 단계에서 매핑을 변수로 보관하여 연결 시 재조회 방지

## 이슈 계층 용어 (한국어)

| 계층 | 한국어 | GitHub Label | 설명 |
|------|--------|-------------|------|
| Level 1 | 업무영역 | `type:업무영역` | 최상위 범주 (Epic) |
| Level 2 | 상세기능 | `type:상세기능` | 기능 단위 (User Story) |
| Level 3 | 개발항목 | `type:개발항목` | 구현 항목 (Task) |
| Level 4 | 단위작업 | `type:단위작업` | 최소 작업 단위 (SubTask) |

## 라벨 규칙

### 유형 라벨 (`type:*`)
- `type:업무영역` — 최상위 업무 범주
- `type:상세기능` — 기능 단위 항목
- `type:개발항목` — 구현해야 할 개발 항목
- `type:단위작업` — 최소 단위 작업

### 상태 라벨 (`status:*`)
- `status:backlog` — 백로그
- `status:todo` — 할 일
- `status:in-progress` — 진행 중
- `status:review` — 리뷰 중
- `status:done` — 완료

## 이슈 생성 규칙 (필수)

이슈 생성 시 반드시 `Windmillsoft/.github` 레포의 이슈 템플릿을 따라야 합니다.

### 템플릿 참조 방법

이슈를 생성하기 전에 아래 명령으로 해당 유형의 템플릿 원본을 읽고, 그 필드 구조대로 body를 작성하세요:

```bash
gh api repos/Windmillsoft/.github/contents/.github/ISSUE_TEMPLATE/{유형}.yml --jq '.content' | base64 -d
```

사용 가능한 유형: `업무영역`, `상세기능`, `개발항목`, `단위작업`, `기능요청`, `기술검토`, `버그리포트`, `변경요청`

### 유형별 기본 라벨

| 유형 | 라벨 |
|------|------|
| 업무영역 | `type:업무영역`, `status:backlog` |
| 상세기능 | `type:상세기능`, `status:backlog` |
| 개발항목 | `type:개발항목`, `status:backlog` |
| 단위작업 | `type:단위작업`, `status:todo` |
| 기능요청 | `enhancement` |
| 기술검토 | `tech-review` |
| 버그리포트 | `bug` |
| 변경요청 | `change-request` |

### 규칙
1. **필수**: `create_issue`/`create_sub_issue` 호출 전에 해당 유형의 템플릿 yml을 읽을 것
2. **필수**: 템플릿의 `validations.required: true` 필드는 반드시 채울 것
3. **필수**: 체크리스트(`- [ ]`)는 구체적인 항목으로 채울 것 (플레이스홀더 금지)
4. **필수**: 각 필드를 `## 필드명` 헤더로 구분하여 body 작성
5. **필수**: 부모 이슈의 context를 참고하여 내용을 채울 것
6. 사용자가 별도 body를 지정한 경우 해당 내용 사용 (단, 필수 필드 누락 시 보완 요청)

## 문서 기반 프로젝트 워크플로우

### 폴더 구조 규약

프로젝트의 요구사항 문서는 아래 구조를 따릅니다:

```
docs/
  requirements/
    공통모듈분석.md                  ← Claude 생성 → 설계자 수정 (프로젝트 수준, 전체 업무영역 횡단)
    공통모듈/
      UI-가이드-{패턴명}.md         ← 공통 UI 패턴 가이드라인 (커스텀리스트, 검색필터, 모달폼 등)
    {업무영역}/
      sources/
        YYYY-MM-DD-자료.md          ← 회의록, 분석 자료, 기존 시스템 문서 등
      요구사항정의서.md              ← Claude 생성 → 설계자 수정
      features/
        상세기능-{기능명}.md         ← Claude 생성 → 설계자 수정
```

### Phase 1: 요구사항 정의

#### Step 1 — 자료 등록

설계자가 업무영역별 `sources/` 폴더에 자료 MD 파일을 등록합니다.
회의록, 분석 자료, 기존 시스템 문서 등 다양한 형태의 입력을 지원합니다.
PDF 파일은 업로드 시 자동으로 MD로 변환됩니다.

#### Step 2 — 요구사항정의서 생성

설계자가 Claude에게 요청하면, 해당 업무영역의 모든 자료를 읽고 `요구사항정의서.md`를 생성합니다.

```
사용자: "고객관리 자료를 분석해서 요구사항정의서를 만들어줘"
Claude: sources/ 내 모든 MD 파일 읽기 → 요구사항정의서.md 생성
```

**덮어쓰기 규칙**: 이미 `요구사항정의서.md`가 존재하는 경우, 사용자에게 덮어쓸지 확인한 후 진행합니다. 상세기능 문서(`features/상세기능-*.md`)도 동일합니다.

#### Step 3 — 설계자 검토/수정

설계자가 `요구사항정의서.md`를 확인하고 수정 완료합니다.

#### Step 4 — 상세기능 문서 생성

설계자가 Claude에게 요청하면, **요구사항정의서 + sources/ 원본 자료를 모두 읽고** `features/` 폴더에 상세기능 MD 파일들을 생성합니다.

```
사용자: "고객관리 요구사항정의서 기반으로 상세기능 문서를 만들어줘"
Claude:
  1. 요구사항정의서.md 읽기
  2. sources/ 내 모든 MD 파일 읽기 (원본 자료 참조)
  3. features/상세기능-{기능명}.md × N 생성
```

**필수**: 상세기능 생성 시 반드시 sources/ 원본 자료도 함께 읽어야 합니다. 요구사항정의서에서 추상화되며 빠진 세부 사항을 원본에서 보완하기 위함입니다.

#### 상세기능 문서 필수 구성

각 상세기능 MD에는 반드시 **프로세스 맵** 섹션을 포함해야 합니다.
동일 기능이라도 프로필/역할에 따라 프로세스가 달라질 수 있으므로, 역할별 행동 흐름을 명시합니다.

```markdown
## 프로세스 맵

| 단계 | 담당자A | 관리자 | 시스템 |
|------|--------|--------|--------|
| 1. 정보 입력 | ● 입력 폼 작성 | | |
| 2. 검증 | | | ● 자동 검증 |
| 3. 승인 요청 | ● 승인 요청 | | |
| 4. 승인/반려 | | ● 승인 결정 | |
| 5. 확정 | | | ● 자동 처리 + 알림 |
```

**규칙**:
1. **필수**: 해당 기능에 관여하는 모든 역할을 열로 나열
2. **필수**: 각 단계에서 누가 무엇을 하는지 구체적으로 명시 (● + 행동 설명)
3. **필수**: 시스템 자동 처리 단계도 포함
4. **권장**: 분기/조건이 있는 경우 별도 행으로 표시 (예: "4a. 승인 시", "4b. 반려 시")

#### Step 4-1 — 커버리지 검증

상세기능 문서 생성 완료 후, sources/ 원본 자료 대비 커버리지를 검증합니다.

```
Claude:
  1. sources/ 각 파일의 핵심 요구사항/기능 항목을 추출
  2. 생성된 상세기능 문서들에서 해당 항목이 다뤄졌는지 대조
  3. 누락/미반영 항목을 체크리스트로 사용자에게 보고
```

출력 형식:
```markdown
## 커버리지 검증 결과

### 반영 완료
- [항목] → 상세기능-{기능명}.md

### 누락/검토 필요
- [항목] (출처: {source파일명}) → 미반영 사유 또는 보완 제안
```

설계자가 누락 항목을 확인하고, 필요 시 추가 생성을 요청합니다.

#### Step 5 — 설계자 검토/수정

설계자가 각 상세기능 MD 파일을 확인하고 수정 완료합니다.

### Phase 1.5: 공통 모듈 분석

상세기능 문서가 확정된 후, 이슈 생성 전에 **전체 업무영역을 횡단**하여 공통 요소를 분석합니다.
분석 결과는 프로젝트 수준의 `docs/requirements/공통모듈분석.md` 파일로 저장합니다.

```
사용자: "공통 모듈을 분석해줘"
Claude:
  1. docs/requirements/*/features/*.md 전체 읽기 (모든 업무영역)
  2. 업무영역 간 중복/공통 요소 횡단 분석:
     - 공통 데이터 모델/오브젝트
     - 공통 비즈니스 로직 (유효성 검증, 권한 체크, 에러 처리 등)
     - 공통 UI 컴포넌트/패턴
     - 공통 유틸리티/헬퍼
  3. docs/requirements/공통모듈분석.md 파일 생성
  4. 사용자에게 요약 보고
```

> **원칙**: 2개 이상 기능이 의존하면 공통 선행, 단일 기능 전용이면 해당 기능 이슈 내 처리

#### 출력 파일: `docs/requirements/공통모듈분석.md`

```markdown
## 공통 모듈 분석 결과

### 공통 데이터/모델 (선행)
| 모듈명 | 설명 | 사용 상세기능 |
|--------|------|--------------|
| 고객 마스터 조회 | 고객 정보 CRUD 공통 로직 | 고객등록, 고객조회, 고객수정 |

### 공통 비즈니스 로직 (선행)
| 모듈명 | 설명 | 사용 상세기능 |
|--------|------|--------------|
| 입력 유효성 검증 | 전화번호, 이메일 등 공통 검증 | 고객등록, 고객수정 |

### 공통 UI/컴포넌트 (선행)
| 모듈명 | 설명 | 사용 상세기능 |
|--------|------|--------------|
| 검색 필터 컴포넌트 | 목록 화면 공통 검색 UI | 고객조회, 이력조회 |

### 공통 UI 가이드라인 (선행)
| UI 패턴 | 가이드라인 문서 | 사용 상세기능 | 주요 규격 |
|---------|---------------|--------------|----------|
| 커스텀 리스트 | `공통모듈/UI-가이드-커스텀리스트.md` | 고객조회, 이력조회, 자산관리 | 컬럼 스타일, 정렬, 페이징, 행 액션 |

> **식별 기준**: 2개+ 상세기능에서 동일 UI 패턴을 커스텀 개발하는 경우, 가이드라인 문서를 먼저 작성.
> 플랫폼 기본 목록 화면으로 충분한 경우는 가이드라인 불필요.
> 가이드라인 문서는 `docs/requirements/공통모듈/UI-가이드-{패턴명}.md`에 저장.
```

설계자가 공통 모듈 목록을 확인/수정하면 Phase 2에서 이를 반영하여 이슈를 생성합니다.

**필수**: 공통 모듈 분석 시 프로젝트의 기술 스택(CLAUDE.md 상단의 기술 스택 섹션)을 참고하여 해당 플랫폼에 적합한 패턴으로 분류합니다.

### Phase 2: 이슈 생성 (MCP)

설계자가 Claude에게 요청하면, 업무영역 MD + 상세기능 MD + 공통 모듈 분석 결과를 기반으로 GitHub 이슈를 생성합니다.

```
사용자: "문서 기반으로 이슈를 생성해줘"
Claude:
  1. 공통모듈분석.md 읽기
  2. create_issue → "공통 모듈" L1 업무영역 이슈 생성
  3. create_sub_issue × N → 공통 모듈 L3 이슈 생성 (선행 작업)

  4. 요구사항정의서.md + features/*.md 읽기
  5. create_issue → 업무영역 L1 이슈 생성
  6. create_sub_issue × N → 상세기능 L2 이슈 생성
  7. create_sub_issue × N → L3/L4 이슈 생성 (기능 내 의존성 순서 + 공통 모듈 의존성 명시)
```

**공통 모듈 이슈 계층**:
```
L1: 공통 모듈 (type:업무영역, status:backlog)
  L3: 공통 고객 마스터 조회 (type:개발항목)    ← 선행
  L3: 공통 유효성 검증 유틸 (type:개발항목)    ← 선행
  ...
```

> **참고**: 공통 모듈 L1에는 L2(상세기능)를 만들지 않고, 바로 L3(개발항목)를 하위로 연결합니다.
> 공통 모듈 L1 이슈가 이미 존재하는 경우, 새로 만들지 않고 기존 이슈에 L3를 추가합니다.

#### L3/L4 이슈 생성 규칙

개발항목(L3) 및 단위작업(L4) 이슈 생성 시, 프로젝트의 기술 스택에 맞는 구현 방식을 반영해야 합니다.

1. **필수**: CLAUDE.md의 기술 스택/개발 컨벤션 섹션을 참고하여 구현 방식 결정
2. **필수**: 공통 모듈이 식별된 경우, 개별 개발항목 body에 의존성 명시
3. **필수**: 설정(Configuration)으로 해결 가능한 항목과 개발(Development)이 필요한 항목을 구분
4. **필수**: 공통 모듈 이슈에 선행 작업 표시를 하여 우선 개발 유도
5. **필수**: 상세기능의 프로세스 맵 전체 단계를 L3/L4가 빠짐없이 커버해야 함 — 프로세스 맵의 각 단계 × 역할을 기준으로 이슈 생성
6. **필수**: 기능 내에서도 L3/L4 간 의존성 순서를 명시 — 데이터 모델 → 보안/권한 → 비즈니스 로직 → UI 순서

```markdown
## 의존성
- 선행 (공통): #20 공통 고객 마스터 조회, #21 공통 유효성 검증 유틸
- 선행 (기능 내): #30 Asset 데이터 모델 정의, #31 Asset 권한 설정
- UI 가이드라인: `공통모듈/UI-가이드-커스텀리스트.md` (#25 공통 UI: 커스텀 리스트)
```

##### 공통모듈 UI 가이드라인 자동 참조

Phase 2 이슈 생성 시, `docs/requirements/공통모듈/` 폴더에 `UI-가이드-*.md` 파일이 존재하면 자동으로 관련 L3/L4 이슈에 참조합니다.

1. **필수**: 이슈 생성 전 `docs/requirements/공통모듈/` 폴더를 스캔
2. **필수**: `UI-가이드-{패턴명}.md` 파일의 `## 적용 대상` 섹션을 읽어 어떤 기능에 적용되는지 파악
3. **필수**: 해당 기능의 L3/L4 이슈(특히 UI 관련) body에 가이드라인 문서를 `## 의존성`에 명시
4. **필수**: 가이드라인에 대응하는 공통 모듈 L3 이슈가 없으면 생성 (예: "공통 UI: 커스텀 리스트")
5. 설계자가 수동으로 만든 가이드라인도 동일하게 스캔 대상에 포함됨

> **참고**: 가이드라인 문서는 Claude가 자동 생성하거나, 설계자가 Extension의 "공통모듈 → 새 가이드라인" 기능으로 직접 등록할 수 있습니다.

### 추적성 규칙 (필수)

문서와 이슈 간 양방향 참조를 유지해야 합니다.

#### 이슈 → 문서 (이슈 body에 출처 기록)

이슈 생성 시 body에 반드시 출처 문서 경로를 포함합니다:

```markdown
## 출처
`docs/requirements/고객관리/features/상세기능-고객등록.md`
```

#### 문서 → 이슈 (MD 파일에 이슈 번호 역참조)

이슈 생성 후, 해당 MD 파일 상단에 관련 이슈 섹션을 추가/업데이트합니다:

```markdown
## 관련 이슈
- 업무영역: #10 고객관리
- 개발항목: #15 고객 정보 입력 폼, #16 유효성 검증
- 단위작업: #17 입력 폼 UI, #18 API 연동
```

### Phase 3: 변경 관리

상세기능 문서가 변경된 경우, Claude가 영향 분석을 수행합니다.

```
사용자: "상세기능-고객등록.md가 변경되었어. 영향받는 이슈를 확인해줘"
Claude:
  1. MD 파일의 "관련 이슈" 섹션에서 이슈 번호 추출
  2. get_issue로 각 이슈 현재 상태 확인
  3. MD 변경 내용과 비교하여 영향 분석:
     - 변경된 이슈 → update_issue로 body 수정
     - 삭제된 요구사항 → update_issue로 close + change-request 라벨
     - 추가된 요구사항 → create_sub_issue로 신규 생성
  4. MD 파일의 "관련 이슈" 섹션 업데이트
```

변경 시 반드시:
1. **필수**: 변경 전 기존 이슈 상태를 먼저 확인할 것
2. **필수**: 변경 계획을 사용자에게 제시하고 승인받을 것
3. **필수**: 이슈 변경 후 MD 파일의 관련 이슈 섹션을 동기화할 것
4. **필수**: 삭제된 요구사항의 이슈는 close하되, `change-request` 라벨을 추가하여 이력 보존
5. **필수**: 이슈 close 시 사유 코멘트를 남길 것 (예: "요구사항 변경으로 불필요해짐. 출처: 상세기능-고객등록.md 2025-02-01 변경")

---

## 작업 흐름 예시

### 예시 1: 자료 → 요구사항 → 이슈 (정규 프로세스)

1. 설계자: `docs/requirements/고객관리/sources/` 에 자료 등록 (회의록, PDF 등)
2. 설계자: "자료를 분석해서 요구사항정의서를 만들어줘"
3. Claude: 자료 읽기 → `요구사항정의서.md` 생성
4. 설계자: 검토 후 수정 완료
5. 설계자: "요구사항정의서 기반으로 상세기능 문서를 만들어줘"
6. Claude: 요구사항정의서 + sources/ 읽기 → `features/상세기능-{기능명}.md` × N 생성
7. Claude: sources 대비 커버리지 검증 → 누락 항목 체크리스트 보고
8. 설계자: 누락 항목 확인 후 추가 생성 요청 또는 불필요 판단
9. 설계자: 각 상세기능 검토 후 수정 완료
10. 설계자: "공통 모듈을 분석해줘"
11. Claude: 전체 업무영역의 features/*.md 횡단 분석 → `docs/requirements/공통모듈분석.md` 생성
12. 설계자: 공통 모듈 확인/수정
13. 설계자: "문서 기반으로 이슈를 생성해줘"
14. Claude: 공통 모듈 이슈(선행) + 상세기능 이슈 + 개발항목/단위작업 이슈 생성 + 양방향 참조 기록

### 예시 2: 변경 관리

1. 설계자: `상세기능-고객등록.md` 수정 (요구사항 추가/변경)
2. 설계자: "변경된 내용으로 이슈를 업데이트해줘"
3. Claude: 관련 이슈 조회 → 영향 분석 → 변경 계획 제시
4. 설계자: 승인
5. Claude: 이슈 업데이트/생성/닫기 + MD 역참조 동기화

### 예시 3: 테스트 이슈 정리

1. 설계자: "이슈 #10과 하위 이슈를 모두 삭제해줘"
2. Claude: `delete_issues(root_issue_number: 10)` → 계층 전체 삭제
3. Claude: 도구가 반환한 "역참조 정리 필요" 목록의 MD 파일에서 삭제된 이슈 번호 제거
4. Claude: 해당 MD 파일의 `## 관련 이슈` 섹션 정리 (삭제된 이슈 행 제거)
